<html>
<head>
	<script type="text/javascript" src="js/smoothie.js"></script>
</head>
<body>
	<h1 style="color:red">Light Level Meter</h1>
	<p><i>This application displays the ambient light level in lux</i></p>

	<h1><center><div id="results">Waiting for light level change...</div></center></h1>

	<div>
		Max value: <div id="max"></div><br/>
		Min value: <div id="min"></div><br/>
	</div>

	<canvas id="mycanvas" height="100px"></canvas>

	<script type="text/javascript">
		var max = -1;
		var min = 10000;
		var value = 0;
		var chartData = new TimeSeries();

		var smoothie = new SmoothieChart({yRangeFunction:myYRangeFunction});
		smoothie.streamTo(document.getElementById("mycanvas"), 1000);

		function myYRangeFunction(range) {
			return {min: min, max: max};
		}

		function updateMax(max_value){
			document.getElementById("max").innerHTML = max_value;
		}		

		function updateMin(min_value){
			document.getElementById("min").innerHTML = min_value;
		}

		document.getElementById('results').innerHTML = "waiting for change in light level...";

		window.addEventListener('devicelight', function(event){
			value = event.value;
			document.getElementById("results").innerHTML = value;
	
			if(value > max){
				max = value;
				updateMax(max);
				smoothie.maxValue = max;
			}

			if(value < min){
				min = value;
				updateMin(min);
				smoothie.minValue = min;
			}
		});

		smoothie.addTimeSeries(chartData, {fillStyle:'rgb(255,0,0'});

		setInterval(function(){
			chartData.append(new Date().getTime(), value);
		}, 1000);

	</script>
</body>
</html>
